import Head from 'next/head'
import { ReactNode, useEffect } from 'react'
import { useVisitorData } from '@fingerprintjs/fingerprintjs-pro-react'
import { CompNavBar } from '@/components/shared/CompNavBar'
import { useAppDispatch } from '@/states/hooks'
import { setUserID } from '@/states/features/user'
import { initUser } from '@/states/thunks/user'

export const RootLayout = ({ children, title = '玩转无限可能' }: {
	children: ReactNode
	title?: string
}) => {
	const dispatch = useAppDispatch()
	const { data: visitorData } = useVisitorData()
	
	useEffect(() => {
		if (visitorData?.visitorId) {
			dispatch(initUser(visitorData.visitorId))
		}
	}, [visitorData?.visitorId])
	
	return (
		<>
			<Head>
				<title>Your ChatGPT</title>
				<meta name="description" content="Generated by create next app"/>
				<meta name="viewport" content="width=device-width, initial-scale=1"/>
				<link rel="icon" href="/favicon.ico"/>
			</Head>
			
			<main className={'w-screen h-screen flex flex-col'}>
				
				<CompNavBar title={title}/>
				
				{children}
			</main>
		</>
	)
}
